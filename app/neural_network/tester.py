import time
from common_util import process_data


class Tester:

    def __init__(self, tester_config, ctm, nn_model, label_class_size):
        self.tester_config = tester_config
        self.ctm = ctm
        self.nn_model = nn_model
        self.label_class_size = label_class_size

    def test(self):
        print "testing start"
        start = time.time()

        try:
            x, y = process_data(
                ctm=self.ctm,
                apps_location=self.tester_config.apps_location,
                label_class_size=self.label_class_size
            )

            if len(x) == 0:
                raise Exception("empty input data")

            accuracy, cross_entropy, lr = self.nn_model.test(x, y)
            print "[ test-result ] accuracy: %r, loss: %r, learning-rate: %r" % (accuracy, cross_entropy, lr)
        except Exception as e:
            raise e

        print "time spent : ", (time.time() - start), " seconds"
        print "testing completed"
